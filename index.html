<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>All my love, Pnoelle</title>
<style>
body {
  font-family: "Century Gothic", sans-serif;
  text-align: center;
  background: linear-gradient(135deg, #d16ba5, #86a8e7, #5ffbf1);
  color: #fff;
  margin: 0;
  padding: 0;
}
#login, #journal {
  margin-top: 40px;
}
textarea {
  width: 80%;
  height: 120px;
  margin: 10px 0;
  border-radius: 8px;
  border: none;
  padding: 10px;
}
button, input {
  padding: 8px 15px;
  margin: 5px;
  cursor: pointer;
  border-radius: 6px;
  border: none;
}
.hidden {
  display: none;
}
#entries {
  margin-top: 30px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  padding: 20px;
}
.entry {
  background: rgba(0,0,0,0.6);
  padding: 15px;
  border-radius: 12px;
  text-align: left;
}
.entry img, .entry video {
  width: 100%;
  margin-top: 10px;
  border-radius: 8px;
}
</style>
</head>
<body>

<h1>All my love, Pnoelle</h1>

<!-- Login -->
<div id="login">
  <p>Enter password:</p>
  <input type="password" id="password">
  <button onclick="checkPassword()">Login</button>
</div>

<!-- Journal -->
<div id="journal" class="hidden">
  <!-- Post Section (Author only) -->
  <div id="postSection" class="hidden">
    <h2>Write a New Entry</h2>
    <textarea id="entryText" placeholder="Write your thoughts..."></textarea><br>
    <input type="file" id="mediaInput" accept="image/*,video/*" multiple><br>
    <button onclick="saveEntry()">Save Entry</button>
  </div>

  <!-- Entries -->
  <div id="entries"></div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
// --- PASSWORDS ---
const authorPassword = "pnoelle2696";
const viewerPassword = "gabk.69";
let role = null;

// --- ELEMENTS ---
const loginDiv = document.getElementById("login");
const journalDiv = document.getElementById("journal");
const postSection = document.getElementById("postSection");
const entriesDiv = document.getElementById("entries");
const entryText = document.getElementById("entryText");
const mediaInput = document.getElementById("mediaInput");

// --- FIREBASE CONFIG ---
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// --- LOGIN ---
function checkPassword() {
  const input = document.getElementById("password").value;
  if (input === authorPassword) { role = "author"; showJournal(true); }
  else if (input === viewerPassword) { role = "viewer"; showJournal(false); }
  else alert("Wrong password!");
}

function showJournal(isAuthor) {
  loginDiv.classList.add("hidden");
  journalDiv.classList.remove("hidden");
  if (isAuthor) { postSection.classList.remove("hidden"); }
  loadEntries();
}

// --- SAVE ENTRY ---
async function saveEntry() {
  const text = entryText.value.trim();
  if (!text && mediaInput.files.length === 0) {
    return alert("Write something or upload media!");
  }

  let mediaFiles = [];
  const files = mediaInput.files;

  for (let file of files) {
    const path = `media/${Date.now()}_${file.name}`;
    const snapshot = await storage.ref(path).put(file);
    const url = await snapshot.ref.getDownloadURL();
    mediaFiles.push({ type: file.type, url });
  }

  await db.collection("entries").add({
    text,
    timestamp: Date.now(),
    media: mediaFiles
  });

  entryText.value = "";
  mediaInput.value = "";
}

// --- LOAD ENTRIES ---
function loadEntries() {
  db.collection("entries").orderBy("timestamp", "desc").onSnapshot(snapshot => {
    entriesDiv.innerHTML = "";
    snapshot.forEach(doc => {
      const e = doc.data();
      const div = document.createElement("div");
      div.className = "entry";
      div.innerHTML = `<strong>${new Date(e.timestamp).toLocaleString()}</strong><br>${e.text || ""}`;
      if (e.media) {
        e.media.forEach(m => {
          if (m.type.startsWith("image/")) {
            const img = document.createElement("img");
            img.src = m.url;
            div.appendChild(img);
          } else if (m.type.startsWith("video/")) {
            const video = document.createElement("video");
            video.src = m.url;
            video.controls = true;
            div.appendChild(video);
          }
        });
      }
      entriesDiv.appendChild(div);
    });
  });
}
</script>
</body>
</html>